<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Rexergy | Register</title>
    <!-- base:css -->
    <link rel="stylesheet" href="../../vendors/mdi/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="../../vendors/css/vendor.bundle.base.css">
    <!-- endinject -->
    <!-- plugin css for this page -->
    <!-- End plugin css for this page -->
    <!-- inject:css -->
    <link rel="stylesheet" href="../../css/style.css">
    <!-- endinject -->
    <link rel="shortcut icon" href="../../images/favicon.png"/>

    <!-- 外部js -->
    <script src="../../js/jquery-3.3.1.min.js" type="text/javascript" charset="utf-8"></script>

    <style>
        .slogan {
            position: absolute;
            width: 600px;
            top: 28%;
            left: 30%;
        }

        .slogan h1 {
            position: absolute;
            font-size: 40px;
            color: #fff;
            line-height: 10px;
            text-align: right;
        }

        .drag {
            width: 300px;
            height: 40px;
            line-height: 40px;
            background-color: #e8e8e8;
            position: relative;
            margin: 0 auto;
        }

        .bg {
            width: 40px;
            height: 100%;
            position: absolute;
            background-color: #75CDF9;
        }

        .text {
            position: absolute;
            width: 100%;
            height: 100%;
            text-align: center;
            user-select: none;
        }

        .btnX {
            width: 40px;
            height: 38px;
            position: absolute;
            border: 1px solid #ccc;
            cursor: move;
            font-family: Sans-serif, serif;
            text-align: center;
            background-color: #fff;
            user-select: none;
            color: #666;
        }

    </style>
</head>

<body>
<div class="container-scroller d-flex">
    <div class="container-fluid page-body-wrapper full-page-wrapper d-flex">
        <div class="content-wrapper d-flex align-items-stretch auth auth-img-bg">
            <div class="row flex-grow">
                <div class="col-lg-6 d-flex align-items-center justify-content-center">
                    <div class="auth-form-transparent text-left p-3">
                        <div class="brand-logo">
                            <img src="../../images/logo.svg" alt="logo">
                        </div>
                        <h4>New here?</h4>
                        <h6 class="font-weight-light">Join us today! It takes only few steps</h6>

                        <form class="pt-3" id="registerForm">
                            <!--Username-->
                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label">Username</label>
                                <div class="col-sm-9">

                                    <div class="input-group">
                                        <div class="input-group-prepend bg-transparent">
                                      <span class="input-group-text bg-transparent border-right-0">
                                        <i class="mdi mdi-account-outline text-primary"></i>
                                      </span>
                                        </div>
                                        <input type="text" class="form-control form-control-lg border-left-0"
                                               id="username" placeholder="Username">
                                    </div>

                                </div>
                            </div>


                            <!--Email-->
                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label">Email</label>
                                <div class="col-sm-9">

                                    <div class="input-group">
                                        <div class="input-group-prepend bg-transparent">
                                          <span class="input-group-text bg-transparent border-right-0">
                                            <i class="mdi mdi-email-outline text-primary"></i>
                                          </span>
                                        </div>
                                        <input type="email" class="form-control form-control-lg border-left-0"
                                               id="email" placeholder="Email">

                                    </div>
                                    <p id="info"></p>

                                </div>
                            </div>

                            <!--Password-->
                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label">Password</label>
                                <div class="col-sm-9">

                                    <div class="input-group">
                                        <div class="input-group-prepend bg-transparent">
                                          <span class="input-group-text bg-transparent border-right-0">
                                            <i class="mdi mdi-lock-outline text-primary"></i>
                                          </span>
                                        </div>

                                        <input type="password" class="form-control form-control-lg border-left-0"
                                               id="password" placeholder="Password">
                                    </div>

                                </div>
                            </div>


                            <!--Postcode-->
                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label">Postcode</label>
                                <div class="col-sm-9">

                                    <div class="input-group">
                                        <div class="input-group-prepend bg-transparent">
                                          <span class="input-group-text bg-transparent border-right-0">
                                                <i class="mdi mdi-map-marker-radius text-primary"></i>
                                          </span>
                                        </div>

                                        <input type="text" class="form-control form-control-lg border-left-0"
                                               id="postcode" placeholder="Postcode">
                                    </div>

                                </div>
                            </div>

                            <!--Plan ID-->
                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label">Plan ID</label>
                                <div class="col-sm-9">

                                    <div class="input-group">
                                        <div class="input-group-prepend bg-transparent">
                                          <span class="input-group-text bg-transparent border-right-0">
                                                <i class="mdi mdi-numeric text-primary"></i>
                                          </span>
                                        </div>

                                        <input type="text" class="form-control form-control-lg border-left-0"
                                               id="planID" placeholder="Plan ID">
                                    </div>

                                </div>
                            </div>

                            <div class="text-center font-weight-light" style="margin-bottom:24px;">
                                or
                            </div>

                            <!--Company Name-->
                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label">Provider Name</label>
                                <div class="col-sm-9">

                                    <div class="input-group">
                                        <div class="input-group-prepend bg-transparent">
                                          <span class="input-group-text bg-transparent border-right-0">
                                                <i class="mdi mdi-city text-primary"></i>
                                          </span>
                                        </div>

                                        <input type="text" class="form-control form-control-lg border-left-0"
                                               id="companyName" placeholder="Provider Name">
                                    </div>

                                </div>
                            </div>

                            <!--Customer Type-->
                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label">Customer Type</label>
                                <div class="col-sm-9">

                                    <div class="input-group">
                                        <select class="form-control" id="customerType">
                                            <option>--Please Select--</option>
                                            <option>Residential</option>
                                            <option>Business</option>
                                        </select>
                                    </div>

                                </div>
                            </div>

                            <!--Tariff Type-->
                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label">Tariff Type</label>
                                <div class="col-sm-9">

                                    <div class="input-group">
                                        <select class="form-control" id="tariffType">
                                            <option>--Please Select--</option>
                                            <option>single</option>
                                            <option>timeofuse</option>
                                            <option>usage</option>
                                            <!-- <option>demand</option> -->
                                        </select>
                                    </div>

                                </div>
                            </div>


                            <!--Verification Bar-->
                            <div class="form-group">
                                <label>Verification Bar</label>
                                <div class="drag">
                                    <div class="bg"></div>
                                    <div class="text" onselectstart="return false;">Drag the slider to unlock.
                                    </div>
                                    <div class="btnX">&gt;&gt;</div>
                                </div>
                            </div>


                            <!--反向查询PlanID-->
                            <script>
                                // 先尝试获取用户填写的内容
                                var postcodeFrame = document.getElementById('postcode');
                                var companyNameFrame = document.getElementById('companyName');
                                var tariffTypeFrame = document.getElementById('tariffType');
                                var customerTypeFrame = document.getElementById('customerType');


                                //离焦事件
                                postcodeFrame.onblur = function () {
                                    detect();
                                };

                                companyNameFrame.onblur = function () {
                                    detect();
                                };


                                tariffTypeFrame.onblur = function () {
                                    detect();
                                };

                                customerTypeFrame.onblur = function () {
                                    detect();
                                };

                                //与服务器联系
                                function detect() {
                                    var postcodeINP = postcodeFrame.value;
                                    var companyNameINP = companyNameFrame.value;
                                    var tariffTypeINP = tariffTypeFrame.value;
                                    var customerTypeINP = customerTypeFrame.value;

                                    $.ajax({
                                        type: "get",
                                        url: "http://54.79.60.225:8080/user/find_energy_plan",
                                        data: {
                                            companyName: companyNameINP,
                                            customerType: customerTypeINP,
                                            postcode: postcodeINP,
                                            tariffType: tariffTypeINP
                                        },
                                        async: false,
                                        success: function (result) {//参数result是服务器响应结果的值
                                            console.log(typeof result.data);
                                            if (typeof result.data !== "undefined") {
                                                var pid = result.data[0].pid;
                                                if (pid != null) {
                                                    document.getElementById('planID').setAttribute('value', pid);
                                                } else {
                                                    document.getElementById('planID').setAttribute('value', '');
                                                }

                                            }
                                        },
                                        error: function (xhr) {
                                            alert("Wrong");
                                        }
                                    });
                                }


                            </script>


                            <script>
                                /*
                                  滑动验证
                                */
                                var slideFlag = false;

                                //一、定义一个获取DOM元素的方法
                                var $ = function (selector) {
                                        return document.querySelector(selector);
                                    },
                                    box = $(".drag"),//容器
                                    bg = $(".bg"),//背景
                                    text = $(".text"),//文字
                                    btnX = $(".btnX"),//滑块
                                    success = false,//是否通过验证的标志
                                    distance = box.offsetWidth - btnX.offsetWidth;//滑动成功的宽度（距离）

                                //二、给滑块注册鼠标按下事件
                                btnX.onmousedown = function (e) {

                                    //1.鼠标按下之前必须清除掉后面设置的过渡属性
                                    btnX.style.transition = "";
                                    bg.style.transition = "";

                                    //说明：clientX 事件属性会返回当事件被触发时，鼠标指针向对于浏览器页面(或客户区)的水平坐标。

                                    //2.当滑块位于初始位置时，得到鼠标按下时的水平位置
                                    var e = e || window.event;
                                    var downX = e.clientX;

                                    //三、给文档注册鼠标移动事件
                                    document.onmousemove = function (e) {
                                        var e = e || window.event;
                                        //1.获取鼠标移动后的水平位置
                                        var moveX = e.clientX;

                                        //2.得到鼠标水平位置的偏移量（鼠标移动时的位置 - 鼠标按下时的位置）
                                        var offsetX = moveX - downX;

                                        //3.在这里判断一下：鼠标水平移动的距离 与 滑动成功的距离 之间的关系
                                        if (offsetX > distance) {
                                            offsetX = distance;//如果滑过了终点，就将它停留在终点位置
                                        } else if (offsetX < 0) {
                                            offsetX = 0;//如果滑到了起点的左侧，就将它重置为起点位置
                                        }

                                        //4.根据鼠标移动的距离来动态设置滑块的偏移量和背景颜色的宽度
                                        btnX.style.left = offsetX + "px";
                                        bg.style.width = offsetX + "px";

                                        //如果鼠标的水平移动距离 = 滑动成功的宽度
                                        if (offsetX === distance) {
                                            //1.设置滑动成功后的样式
                                            text.innerHTML = "Verified successfully.";
                                            text.style.color = "#fff";
                                            //btnX.innerHTML = "&radic;";
                                            btnX.innerHTML = "✓";
                                            btnX.style.color = "green";
                                            bg.style.backgroundColor = "lightgreen";

                                            //2.设置滑动成功后的状态
                                            success = true;
                                            //成功后，清除掉鼠标按下事件和移动事件（因为移动时并不会涉及到鼠标松开事件）
                                            btnX.onmousedown = null;
                                            document.onmousemove = null;

                                            //3.成功解锁后的回调函数
                                            setTimeout(function () {
                                                //alert('Verified successfully');
                                                slideFlag = true;
                                            }, 100);
                                        }
                                    };

                                    //四、给文档注册鼠标松开事件
                                    document.onmouseup = function (e) {

                                        //如果鼠标松开时，滑到了终点，则验证通过
                                        if (success) {
                                            return;
                                        } else {
                                            //反之，则将滑块复位（设置了1s的属性过渡效果）
                                            btnX.style.left = 0;
                                            bg.style.width = 0;
                                            btnX.style.transition = "left 1s ease";
                                            bg.style.transition = "width 1s ease";
                                        }
                                        //只要鼠标松开了，说明此时不需要拖动滑块了，那么就清除鼠标移动和松开事件。
                                        document.onmousemove = null;
                                        document.onmouseup = null;
                                    }
                                };
                            </script>

                            <div class="mb-4">
                                <div class="form-check">
                                    <label class="form-check-label text-muted">
                                        <input type="checkbox" class="form-check-input" id="chb">
                                        I agree to all Terms & Conditions
                                    </label>
                                </div>
                            </div>

                            <div class="mt-3">
                                <a class="btn btn-block btn-primary btn-lg font-weight-medium auth-form-btn"
                                   id="btn">SIGN UP</a>
                            </div>


                            <div class="text-center mt-4 font-weight-light">
                                Already have an account? <a href="login.html" class="text-primary">Login</a>
                            </div>

                        </form>


                    </div>
                </div>
                <div class="col-lg-6 register-half-bg d-none d-lg-flex flex-row">
                    <div class="slogan">
                        <h1>Your Personal Energy Advocate.</h1>
                    </div>
                    <p class="text-white font-weight-medium text-center flex-grow align-self-end">Copyright © 2021
                        Energy Dash Team. All rights reserved.</p>
                </div>
            </div>
        </div>
        <!-- content-wrapper ends -->
    </div>
    <!-- page-body-wrapper ends -->
</div>
<!-- container-scroller -->
<!-- base:js -->
<script src="../../vendors/js/vendor.bundle.base.js"></script>
<!-- endinject -->
<!-- inject:js -->
<script src="../../js/off-canvas.js"></script>
<script src="../../js/hoverable-collapse.js"></script>
<script src="../../js/template.js"></script>
<!-- endinject -->


<script>
    /*
    检测邮箱是否可用
     */

    // 获取页面中的元素
    var emailInp = document.getElementById("email");
    var info = document.getElementById('info');
    var emailFlag = false;

    // 当文本框离开焦点以后
    emailInp.onblur = function () {
        // 获取用户输入的邮箱地址
        var verifiedEmail = this.value;

        // 验证邮箱地址的正则表达式
        var reg = /^[A-Za-z\d]+([-_.][A-Za-z\d]+)*@([A-Za-z\d]+[-.])+[A-Za-z\d]{2,4}$/;
        // 如果用户输入的邮箱地址不符合规则
        if (!reg.test(verifiedEmail)) {
            // 给出用户提示
            info.innerHTML = 'Please enter an email address that conforms to the rules';
            // 让提示信息显示为错误提示信息的样式
            info.className = 'bg-danger';
            // 阻止程序向下执行
            return;
        }

        var originalEmail = "1";
        $.ajax({
            type: "get",
            url: "http://54.79.60.225:8080/user/verify_email_address",
            data: {
                verifiedEmail: verifiedEmail,
                originalEmail: originalEmail
            },
            success: function (result) {//参数result是服务器响应结果的值
                info.innerHTML = result.data.message;
                if (result.data.message === 'Congratulations, the email address is available.') {
                    info.className = 'bg-success';
                    emailFlag = true;
                } else {
                    info.className = 'bg-danger';
                    emailFlag = false;
                }
            },
            error: function (xhr) {
                //console.log(xhr);
                info.innerHTML = xhr.message;
                info.className = 'bg-danger';
            }

        });

    };


    /*
    提交信息
     */
    $("#btn").on('click', function () {
        if (!emailFlag) {
            alert("Sorry, you can not use this email address.");
            emailFlag = false;
            return;
        } else {
            // 用户名为空
            if (document.getElementById("username").value === "") {
                alert("Sorry, the username cannot be empty.");
                return;
            } else {
                // 密码长度不对，必须是8-16位
                if (document.getElementById("password").value.length < 8 || document.getElementById("password").value.length > 16) {
                    alert("Sorry, the password should be 8-16 in length.");
                    return;
                } else {
                    // 邮编为空
                    if (document.getElementById("postcode").value === "") {
                        alert("Sorry, the postcode cannot be empty.");
                        return;
                    } else {
                        // 未同意隐私条款
                        if (!document.getElementById('chb').checked) {
                            alert("Sorry, you must agree to the privacy policy to register.");
                            return;
                        } else {
                            //未通过滑动验证
                            if (!slideFlag) {
                                alert("Sorry, please prove that you are not a robot by sliding the verification bar.");
                                return;
                            } else {
                                // 先尝试获取文本框中的内容。如果不为空说明用户修改过了。
                                var usernameINP = document.getElementById('username').value;
                                var passwordINP = document.getElementById('password').value;
                                var postcodeINP = document.getElementById('postcode').value;
                                var emailINP = document.getElementById('email').value;
                                var planIDINP = document.getElementById('planID').value;

                                $.ajax({
                                    type: "post",
                                    url: 'http://54.79.60.225:8080/user/sign_up',
                                    data: {
                                        email: emailINP,
                                        password: passwordINP,
                                        postcode: postcodeINP,
                                        userName: usernameINP,
                                        planId: planIDINP
                                    }

                                });
                                alert("Register successfully.");
                                flag = false;
                                window.location.href = "http://54.79.60.225/pages/auth/login.html?";
                            }
                        }

                    }

                }

            }
        }


    });

</script>


</body>

</html>