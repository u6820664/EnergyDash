<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Rexergy | Register</title>
    <!-- base:css -->
    <link rel="stylesheet" href="../../vendors/mdi/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="../../vendors/css/vendor.bundle.base.css">
    <!-- endinject -->
    <!-- plugin css for this page -->
    <!-- End plugin css for this page -->
    <!-- inject:css -->
    <link rel="stylesheet" href="../../css/style.css">
    <!-- endinject -->
    <link rel="shortcut icon" href="../../images/favicon.png"/>

    <!-- 外部js -->
    <script src="../../js/jquery-3.3.1.min.js"></script>

    <style>
        .slogan {
            position: absolute;
            width: 600px;
            top: 28%;
            left: 30%;
        }

        .slogan h1 {
            position: absolute;
            font-size: 40px;
            color: #fff;
            line-height: 10px;
            text-align: right;
        }
    </style>
</head>

<body>
<div class="container-scroller d-flex">
    <div class="container-fluid page-body-wrapper full-page-wrapper d-flex">
        <div class="content-wrapper d-flex align-items-stretch auth auth-img-bg">
            <div class="row flex-grow">
                <div class="col-lg-6 d-flex align-items-center justify-content-center">
                    <div class="auth-form-transparent text-left p-3">
                        <div class="brand-logo">
                            <img src="../../images/logo.svg" alt="logo">
                        </div>
                        <h4>New here?</h4>
                        <h6 class="font-weight-light">Join us today! It takes only few steps</h6>
                        <form class="pt-3" id="registerForm">
                            <div class="form-group">
                                <label>Username</label>
                                <div class="input-group">
                                    <div class="input-group-prepend bg-transparent">
                      <span class="input-group-text bg-transparent border-right-0">
                        <i class="mdi mdi-account-outline text-primary"></i>
                      </span>
                                    </div>
                                    <input type="text" class="form-control form-control-lg border-left-0" id="username"
                                           placeholder="Username">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <div class="input-group">
                                    <div class="input-group-prepend bg-transparent">
                                          <span class="input-group-text bg-transparent border-right-0">
                                            <i class="mdi mdi-email-outline text-primary"></i>
                                          </span>
                                    </div>
                                    <input type="email" class="form-control form-control-lg border-left-0" id="email"
                                           placeholder="Email">

                                </div>
                                <p id="info"></p>

                            </div>


                            <div class="form-group">
                                <label>Password</label>
                                <div class="input-group">
                                    <div class="input-group-prepend bg-transparent">
                                          <span class="input-group-text bg-transparent border-right-0">
                                            <i class="mdi mdi-lock-outline text-primary"></i>
                                          </span>
                                    </div>

                                    <input type="password" class="form-control form-control-lg border-left-0"
                                           id="password" placeholder="Password">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Postcode</label>
                                <div class="input-group">
                                    <div class="input-group-prepend bg-transparent">
                                          <span class="input-group-text bg-transparent border-right-0">
                                            <i class="mdi mdi-lock-outline text-primary"></i>
                                          </span>
                                    </div>

                                    <input type="password" class="form-control form-control-lg border-left-0"
                                           id="password" placeholder="Postcode">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Verification code</label>
                                <div class="input-group">
                                    <div class="input-group-prepend bg-transparent">
                                          <span class="input-group-text bg-transparent border-right-0">
                                            <i class="mdi mdi-lock-outline text-primary"></i>
                                          </span>
                                    </div>

                                    <input type="password" class="form-control form-control-lg border-left-0"
                                           id="password" placeholder="Verification code">
                                </div>
                            </div>

                            <div class="mb-4">
                                <div class="form-check">
                                    <label class="form-check-label text-muted">
                                        <input type="checkbox" class="form-check-input" id="chb">
                                        I agree to all Terms & Conditions
                                    </label>
                                </div>
                            </div>

                            <div class="mt-3">
                                <a class="btn btn-block btn-primary btn-lg font-weight-medium auth-form-btn"
                                   id="btn">SIGN UP</a>
                            </div>


                            <div class="text-center mt-4 font-weight-light">
                                Already have an account? <a href="login.html" class="text-primary">Login</a>
                            </div>

                        </form>


                    </div>
                </div>
                <div class="col-lg-6 register-half-bg d-none d-lg-flex flex-row">
                    <div class="slogan">
                        <h1>Your Personal Energy Advocate.</h1>
                    </div>
                    <p class="text-white font-weight-medium text-center flex-grow align-self-end">Copyright © 2020
                        Energy Dash Team. All rights reserved.</p>
                </div>
            </div>
        </div>
        <!-- content-wrapper ends -->
    </div>
    <!-- page-body-wrapper ends -->
</div>
<!-- container-scroller -->
<!-- base:js -->
<script src="../../vendors/js/vendor.bundle.base.js"></script>
<!-- endinject -->
<!-- inject:js -->
<script src="../../js/off-canvas.js"></script>
<script src="../../js/hoverable-collapse.js"></script>
<script src="../../js/template.js"></script>
<!-- endinject -->

<!--To be fix with Real API-->
<!--<script>-->
<!--    $(document).ready(function () {-->
<!--        $('#registerForm').click(function (e) {-->
<!--            e.preventDefault();-->
<!--            $.ajax({-->
<!--                type: 'POST',-->
<!--                url: 'https://reqres.in/api/register',-->
<!--                data: {-->
<!--                    username: $('#username').val(),-->
<!--                    email: $('#email').val(),-->
<!--                    password: $('#password').val()-->
<!--                },-->
<!--                success: function (response) {-->
<!--                    alert("success");-->
<!--                },-->
<!--                error: function (result) {-->
<!--                    alert('error');-->
<!--                }-->
<!--            });-->
<!--        });-->
<!--    });-->
<!--</script>-->


<script>
    /*
    检测邮箱是否可用
     */

    // 获取页面中的元素
    var emailInp = document.getElementById("email");
    var info = document.getElementById('info');
    var emailFlag = false;


    // 当文本框离开焦点以后
    emailInp.onblur = function () {
        // 获取用户输入的邮箱地址
        var verifiedEmail = this.value;

        // 验证邮箱地址的正则表达式
        var reg = /^[A-Za-z\d]+([-_.][A-Za-z\d]+)*@([A-Za-z\d]+[-.])+[A-Za-z\d]{2,4}$/;
        // 如果用户输入的邮箱地址不符合规则
        if (!reg.test(verifiedEmail)) {
            // 给出用户提示
            info.innerHTML = 'Please enter an email address that conforms to the rules';
            // 让提示信息显示为错误提示信息的样式
            info.className = 'bg-danger';
            // 阻止程序向下执行
            return;
        }


        $.ajax({
            type: "get",
            url: "register_email_address",
            data: {
                verifiedEmail: verifiedEmail
            },
            success: function (result) {//参数result是服务器响应结果的值
                info.innerHTML = result.message;
                if (result.message === 'Congratulations, the email address is available.') {
                    info.className = 'bg-success';
                    emailFlag = true;
                } else {
                    info.className = 'bg-danger';
                    emailFlag = false;
                }
            },
            error: function (xhr) {
                //console.log(xhr);
                info.innerHTML = xhr.message;
                info.className = 'bg-danger';
            }

        });

    };


    /*
    提交信息
     */
    $("#btn").on('click', function () {
        if (!emailFlag) {
            alert("Sorry, you can not use this email address.");
            emailFlag = false;
            return;
        } else {
            //"unchecked"
            if (!document.getElementById('chb').checked) {
                alert("Sorry, you must agree to the privacy policy to register.");
                return;
            } else {
                // 密码栏为空
                if (document.getElementById("password").value === "") {
                    alert("Sorry, the password cannot be empty.");
                    return;
                } else {
                    // 用户名为空
                    if (document.getElementById("username").value === "") {
                        alert("Sorry, the username cannot be empty.");
                        return;

                    } else {
                        // 先尝试获取文本框中的内容。如果不为空说明用户修改过了。
                        var usernameINP = document.getElementById('username').value;
                        var passwordINP = document.getElementById('password').value;
                        //var planIDINP = document.getElementById('planID').value;
                        var emailINP = document.getElementById('email').value;


                        $.ajax({
                            type: "post",
                            url: 'editServlet',
                            data: {
                                password: passwordINP,
                                //planId: planIDOtp,
                                userName: usernameINP,
                                email: emailINP,
                            }

                        });
                        alert("Submit successfully.");
                        flag = false;
                    }

                }
            }

        }
    });

</script>


</body>

</html>